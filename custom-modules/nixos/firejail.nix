{
  config,
  lib,
  pkgs,
  ...
}:
with lib; let
  cfg = config.custom.firejail;

  # Complete list of all available firejail programs (1,319 total)
  # This list contains all programs that have firejail profiles available
  allFirejailPrograms = [
    "0ad"
    "1password"
    "2048-qt"
    "7z"
    "7za"
    "7zr"
    "abiword"
    "abrowser"
    "acat"
    "adiff"
    "agetpkg"
    "akonadi_control"
    "akregator"
    "alacarte"
    "alienarena"
    "alienarena-wrapper"
    "alienblaster"
    "alpine"
    "alpinef"
    "als"
    "amarok"
    "amule"
    "amuled"
    "android-studio"
    "ani-cli"
    "anki"
    "anydesk"
    "aosp"
    "apack"
    "apktool"
    "apostrophe"
    "ar"
    "arch-audit"
    "archaudit-report"
    "archiver-common"
    "ardour4"
    "ardour5"
    "arduino"
    "arepack"
    "aria2c"
    "aria2p"
    "aria2rpc"
    "ark"
    "arm"
    "armcord"
    "artha"
    "assogiate"
    "asunder"
    "atom"
    "atom-beta"
    "atool"
    "atril"
    "atril-previewer"
    "atril-thumbnailer"
    "audacious"
    "audacity"
    "audio-recorder"
    "aunpack"
    "authenticator"
    "authenticator-rs"
    "autokey-common"
    "autokey-gtk"
    "autokey-qt"
    "autokey-run"
    "autokey-shell"
    "avidemux"
    "avidemux3_cli"
    "avidemux3_jobs_qt5"
    "avidemux3_qt5"
    "aweather"
    "awesome"
    "axel"
    "b2sum"
    "b3sum"
    "ballbuster"
    "ballbuster-wrapper"
    "baloo_file"
    "baloo_filemetadata_temp_extractor"
    "balsa"
    "baobab"
    "barrier"
    "basilisk"
    "bcompare"
    "beaker"
    "bibletime"
    "bibtex"
    "bijiben"
    "bitcoin-qt"
    "bitlbee"
    "bitwarden"
    "bitwarden-desktop"
    "blackbox"
    "bleachbit"
    "blender"
    "blender-2.8"
    "blender-3.6"
    "bless"
    "blink-common"
    "blobby"
    "blobwars"
    "bluefish"
    "bnox"
    "Books"
    "bpftop"
    "brackets"
    "brasero"
    "brave"
    "brave-browser"
    "brave-browser-beta"
    "brave-browser-dev"
    "brave-browser-nightly"
    "brave-browser-stable"
    "brz"
    "bsdcat"
    "bsdcpio"
    "bsdtar"
    "Builder"
    "build-systems-common"
    "buku"
    "bundle"
    "bunzip2"
    "bzcat"
    "bzflag"
    "bzip2"
    "bzr"
    "cachy-browser"
    "caja"
    "calibre"
    "calligra"
    "calligraauthor"
    "calligraconverter"
    "calligraflow"
    "calligragemini"
    "calligraplan"
    "calligraplanwork"
    "calligrasheets"
    "calligrastage"
    "calligrawords"
    "cameramonitor"
    "cantata"
    "cargo"
    "catfish"
    "cawbird"
    "celluloid"
    "chafa"
    "chatterino"
    "checkbashisms"
    "cheese"
    "Cheese"
    "cherrytree"
    "chromium"
    "chromium-browser"
    "chromium-browser-privacy"
    "chromium-common"
    "chromium-freeworld"
    "cin"
    "cinelerra"
    "cinelerra-gg"
    "cksum"
    "clac"
    "clamav"
    "clamdscan"
    "clamdtop"
    "clamscan"
    "clamtk"
    "clawsker"
    "claws-mail"
    "clementine"
    "clion"
    "clion-eap"
    "clipgrab"
    "clipit"
    "cliqz"
    "clocks"
    "cloneit"
    "cmake"
    "cmus"
    "code"
    "code-oss"
    "codium"
    "cointop"
    "cola"
    "colorful"
    "colorful-wrapper"
    "com.github.bleakgrey.tootle"
    "com.github.dahenson.agenda"
    "com.github.johnfactotum.Foliate"
    "com.github.phase1geo.minder"
    "com.github.tchx84.Flatseal"
    "com.gitlab.newsflash"
    "conkeror"
    "conky"
    "conplay"
    "corebird"
    "cower"
    "coyim"
    "cpio"
    "crawl"
    "crawl-tiles"
    "crow"
    "cryptocat"
    "Cryptocat"
    "curl"
    "cvlc"
    "cyberfox"
    "Cyberfox"
    "daisy"
    "darktable"
    "dbus-debug-common"
    "dbus-send"
    "dconf"
    "dconf-editor"
    "ddgr"
    "ddgtk"
    "deadbeef"
    "deadlink"
    "default"
    "deluge"
    "desktopeditors"
    "devhelp"
    "device-flasher.linux"
    "devilspie"
    "devilspie2"
    "dex2jar"
    "dexios"
    "d-feet"
    "dia"
    "dig"
    "digikam"
    "dillo"
    "dino"
    "dino-im"
    "discord"
    "Discord"
    "discord-canary"
    "DiscordCanary"
    "discord-common"
    "discord-ptb"
    "DiscordPTB"
    "display"
    "display-im6.q16"
    "dnox"
    "dnscrypt-proxy"
    "dnsmasq"
    "Documents"
    "dolphin"
    "dolphin-emu"
    "dooble"
    "dooble-qt4"
    "dosbox"
    "dragon"
    "drawio"
    "drill"
    "dropbox"
    "d-spy"
    "dtui"
    "easystroke"
    "ebook-convert"
    "ebook-edit"
    "ebook-meta"
    "ebook-polish"
    "ebook-viewer"
    "editorconfiger"
    "electron-cash"
    "electron-common"
    "electron-mail"
    "electrum"
    "element-desktop"
    "elinks"
    "emacs"
    "email-common"
    "empathy"
    "enchant"
    "enchant-2"
    "enchant-lsmod"
    "enchant-lsmod-2"
    "engrampa"
    "enox"
    "enpass"
    "eo-common"
    "eog"
    "eom"
    "ephemeral"
    "epiphany"
    "equalx"
    "erd"
    "et"
    "etr"
    "etr-wrapper"
    "evince"
    "evince-previewer"
    "evince-thumbnailer"
    "evolution"
    "exfalso"
    "exiftool"
    "falkon"
    "fbreader"
    "FBReader"
    "fdns"
    "feedreader"
    "feh"
    "ferdi"
    "fetchmail"
    "ffmpeg"
    "ffmpegthumbnailer"
    "ffplay"
    "ffprobe"
    "file"
    "file-manager-common"
    "file-roller"
    "filezilla"
    "firedragon"
    "firefox"
    "firefox-beta"
    "firefox-common"
    "firefox-common-addons"
    "firefox-developer-edition"
    "firefox-esr"
    "firefox-nightly"
    "firefox-wayland"
    "firefox-x11"
    "five-or-more"
    "fix-qdf"
    "flacsplt"
    "flameshot"
    "flashpeak-slimjet"
    "floorp"
    "flowblade"
    "fluffychat"
    "fluxbox"
    "foliate"
    "fontforge"
    "font-manager"
    "fossamail"
    "FossaMail"
    "four-in-a-row"
    "fractal"
    "franz"
    "freecad"
    "freecadcmd"
    "freeciv"
    "freeciv-gtk3"
    "freeciv-mp-gtk3"
    "freecol"
    "freemind"
    "freeoffice-planmaker"
    "freeoffice-presentations"
    "freeoffice-textmaker"
    "freetube"
    "freshclam"
    "Fritzing"
    "frogatto"
    "frozen-bubble"
    "ftp"
    "funnyboat"
    "gajim"
    "gajim-history-manager"
    "galculator"
    "gallery-dl"
    "gapplication"
    "gcalccmd"
    "gcloud"
    "gconf"
    "gconf-editor"
    "gconf-merge-schema"
    "gconf-merge-tree"
    "gconfpkg"
    "gconftool-2"
    "gdu"
    "geany"
    "geary"
    "gedit"
    "geekbench"
    "geeqie"
    "geki2"
    "geki3"
    "gfeeds"
    "gget"
    "gh"
    "ghb"
    "ghostwriter"
    "gimp"
    "gimp-2.10"
    "gimp-2.8"
    "gist"
    "gist-paste"
    "git"
    "git-cola"
    "gitg"
    "github-desktop"
    "gitter"
    "Gitter"
    "gjs"
    "gl-117"
    "gl-117-wrapper"
    "glaxium"
    "glaxium-wrapper"
    "globaltime"
    "gmpc"
    "gnome-2048"
    "gnome-books"
    "gnome-boxes"
    "gnome-builder"
    "gnome-calculator"
    "gnome-calendar"
    "gnome-character-map"
    "gnome-characters"
    "gnome-chess"
    "gnome-clocks"
    "gnome-contacts"
    "gnome-documents"
    "gnome-font-viewer"
    "gnome_games-common"
    "gnome-hexgl"
    "gnome-keyring"
    "gnome-keyring-3"
    "gnome-keyring-daemon"
    "gnome-klotski"
    "gnome-latex"
    "gnome-logs"
    "gnome-mahjongg"
    "gnome-maps"
    "gnome-mines"
    "gnome-mplayer"
    "gnome-mpv"
    "gnome-music"
    "gnome-nettool"
    "gnome-nibbles"
    "gnome-passwordsafe"
    "gnome-photos"
    "gnome-pie"
    "gnome-pomodoro"
    "gnome-recipes"
    "gnome-ring"
    "gnome-robots"
    "gnome-schedule"
    "gnome-screenshot"
    "gnome-sound-recorder"
    "gnome-sudoku"
    "gnome-system-log"
    "gnome-taquin"
    "gnome-tetravex"
    "gnome-todo"
    "gnome-twitch"
    "gnome-weather"
    "gnote"
    "gnubik"
    "godot"
    "godot3"
    "goldendict"
    "goobox"
    "google-chrome"
    "google-chrome-beta"
    "google-chrome-stable"
    "google-chrome-unstable"
    "google-earth"
    "google-earth-pro"
    "google-play-music-desktop-player"
    "googler"
    "googler-common"
    "gpa"
    "gpg"
    "gpg2"
    "gpg-agent"
    "gpicview"
    "gpredict"
    "gradio"
    "gramps"
    "gravity-beams-and-evaporating-stars"
    "green-recoder"
    "gsettings"
    "gsettings-data-convert"
    "gsettings-schema-convert"
    "gtar"
    "gthumb"
    "gtk2-youtube-viewer"
    "gtk3-youtube-viewer"
    "gtk-lbry-viewer"
    "gtk-pipe-viewer"
    "gtk-straw-viewer"
    "gtk-update-icon-cache"
    "gtk-youtube-viewer"
    "gtk-youtube-viewers-common"
    "guayadeque"
    "gucharmap"
    "gummi"
    "gunzip"
    "guvcview"
    "gwenview"
    "gzexe"
    "gzip"
    "handbrake"
    "handbrake-gtk"
    "hashcat"
    "hasher-common"
    "hedgewars"
    "hexchat"
    "highlight"
    "hitori"
    "hledger"
    "hledger-ui"
    "homebank"
    "host"
    "hugin"
    "hyperrogue"
    "i2prouter"
    "i3"
    "iagno"
    "icecat"
    "icedove"
    "iceweasel"
    "idea"
    "ideaIC"
    "idea.sh"
    "imagej"
    "img2txt"
    "impressive"
    "imv"
    "inkscape"
    "inkview"
    "inox"
    "io.github.lainsce.Notejot"
    "ipcalc"
    "ipcalc-ng"
    "iridium"
    "iridium-browser"
    "irssi"
    "itch"
    "jami"
    "jami-gnome"
    "jd-gui"
    "jdownloader"
    "JDownloader"
    "jerry"
    "jitsi"
    "jitsi-meet-desktop"
    "journal-viewer"
    "jumpnbump"
    "jumpnbump-menu"
    "k3b"
    "kaffeine"
    "kalgebra"
    "kalgebramobile"
    "karbon"
    "kate"
    "kazam"
    "kcalc"
    "kdeinit4"
    "kdenlive"
    "kdiff3"
    "keepass"
    "keepass2"
    "keepassx"
    "keepassx2"
    "keepassxc"
    "keepassxc-cli"
    "keepassxc-proxy"
    "kfind"
    "kget"
    "kid3"
    "kid3-cli"
    "kid3-qt"
    "kino"
    "kiwix-desktop"
    "klatexformula"
    "klatexformula_cmdl"
    "klavaro"
    "kmail"
    "kmplayer"
    "knotes"
    "kodi"
    "kontact"
    "konversation"
    "kopete"
    "koreader"
    "krita"
    "krunner"
    "ktorrent"
    "ktouch"
    "kube"
    "kwin_x11"
    "kwrite"
    "latex"
    "latex-common"
    "lbreakouthd"
    "lbry-viewer"
    "lbry-viewer-gtk"
    "lbunzip2"
    "lbzcat"
    "lbzip2"
    "leafpad"
    "ledger-live-desktop"
    "less"
    "lettura"
    "librecad"
    "libreoffice"
    "librewolf"
    "librewolf-nightly"
    "lifeograph"
    "liferea"
    "lightsoff"
    "lincity-ng"
    "links"
    "links2"
    "links-common"
    "linphone"
    "linuxqq"
    "lmms"
    "lobase"
    "lobster"
    "localc"
    "localsend_app"
    "lodraw"
    "loffice"
    "lofromtemplate"
    "Logs"
    "loimpress"
    "lollypop"
    "lomath"
    "loupe"
    "loweb"
    "lowriter"
    "lrunzip"
    "lrz"
    "lrzcat"
    "lrzip"
    "lrztar"
    "lrzuntar"
    "lsar"
    "lugaru"
    "luminance-hdr"
    "lutris"
    "lximage-qt"
    "lxmusic"
    "lynx"
    "lyriek"
    "lyx"
    "lz4"
    "lz4c"
    "lz4cat"
    "lzcat"
    "lzcmp"
    "lzdiff"
    "lzegrep"
    "lzfgrep"
    "lzgrep"
    "lzip"
    "lzless"
    "lzma"
    "lzmadec"
    "lzmainfo"
    "lzmore"
    "lzop"
    "macrofusion"
    "Maelstrom"
    "magicor"
    "make"
    "makedeb"
    "makepkg"
    "man"
    "manaplus"
    "Maps"
    "marker"
    "masterpdfeditor"
    "masterpdfeditor4"
    "masterpdfeditor5"
    "mate-calc"
    "mate-calculator"
    "mate-color-select"
    "mate-dictionary"
    "mathematica"
    "Mathematica"
    "matrix-mirage"
    "mattermost-desktop"
    "mcabber"
    "mcomix"
    "md5sum"
    "mdr"
    "mediainfo"
    "mediathekview"
    "megaglest"
    "megaglest_editor"
    "meld"
    "mencoder"
    "mendeleydesktop"
    "menulibre"
    "meson"
    "metadata-cleaner"
    "meteo-qt"
    "microsoft-edge"
    "microsoft-edge-beta"
    "microsoft-edge-dev"
    "microsoft-edge-stable"
    "midori"
    "mimetype"
    "min"
    "mindless"
    "minecraft-launcher"
    "minetest"
    "minitube"
    "mirage"
    "mirrormagic"
    "mocp"
    "monero-wallet-cli"
    "mousepad"
    "mov-cli"
    "mp3splt"
    "mp3splt-gtk"
    "mp3wrap"
    "mpd"
    "mpDris2"
    "mpg123"
    "mpg123-alsa"
    "mpg123.bin"
    "mpg123-id3dump"
    "mpg123-jack"
    "mpg123-nas"
    "mpg123-openal"
    "mpg123-oss"
    "mpg123-portaudio"
    "mpg123-pulse"
    "mpg123-strip"
    "mplayer"
    "mpsyt"
    "mpv"
    "mrrescue"
    "ms-excel"
    "ms-office"
    "ms-onenote"
    "ms-outlook"
    "ms-powerpoint"
    "ms-skype"
    "ms-word"
    "mtpaint"
    "mullvad-browser"
    "multimc"
    "multimc5"
    "mumble"
    "mupdf"
    "mupdf-gl"
    "mupdf-x11"
    "mupdf-x11-curl"
    "mupen64plus"
    "muraster"
    "musescore"
    "musictube"
    "musixmatch"
    "mutool"
    "mutt"
    "mypaint"
    "mypaint-ora-thumbnailer"
    "nano"
    "natron"
    "Natron"
    "nautilus"
    "ncdu"
    "ncdu2"
    "ncmpcpp"
    "nemo"
    "neochat"
    "neomutt"
    "netactview"
    "nethack"
    "nethack-vultures"
    "netsurf"
    "neverball"
    "neverball-wrapper"
    "neverputt"
    "neverputt-wrapper"
    "newsbeuter"
    "newsboat"
    "newsflash"
    "nextcloud"
    "nextcloud-desktop"
    "nheko"
    "nhex"
    "nicotine"
    "nitroshare"
    "nitroshare-cli"
    "nitroshare-nmh"
    "nitroshare-send"
    "nitroshare-ui"
    "node"
    "node-gyp"
    "nodejs-common"
    "nomacs"
    "noprofile"
    "notable"
    "notify-send"
    "npm"
    "npx"
    "nslookup"
    "nsxiv"
    "nuclear"
    "nvim"
    "nylas"
    "nyx"
    "obs"
    "obsidian"
    "ocenaudio"
    "odt2txt"
    "oggsplt"
    "okular"
    "onboard"
    "onionshare"
    "onionshare-cli"
    "onionshare-gui"
    "ooffice"
    "ooviewdoc"
    "openarena"
    "openarena_ded"
    "openbox"
    "opencity"
    "openclonk"
    "open-invaders"
    "openmw"
    "openmw-launcher"
    "openoffice.org"
    "openshot"
    "openshot-qt"
    "openstego"
    "openttd"
    "opera"
    "opera-beta"
    "opera-developer"
    "orage"
    "org.gnome.NautilusPreviewer"
    "org.gnome.seahorse.Application"
    "ostrichriders"
    "otter-browser"
    "ouch"
    "out123"
    "p7zip"
    "palemoon"
    "pandoc"
    "parole"
    "parsecd"
    "patch"
    "pavucontrol"
    "pavucontrol-qt"
    "pcmanfm"
    "PCSX2"
    "pcsxr"
    "pdfchain"
    "pdflatex"
    "pdfmod"
    "pdfsam"
    "pdftotext"
    "peek"
    "penguin-command"
    "photoflare"
    "picard"
    "pidgin"
    "pinball"
    "pinball-wrapper"
    "ping"
    "pingus"
    "pinta"
    "pioneer"
    "pip"
    "pipe-viewer"
    "pipe-viewer-gtk"
    "pithos"
    "pitivi"
    "pix"
    "pkglog"
    "planmaker18"
    "planmaker18free"
    "playonlinux"
    "pluma"
    "plv"
    "pngquant"
    "pnpm"
    "pnpx"
    "polari"
    "postman"
    "Postman"
    "ppsspp"
    "PPSSPPQt"
    "PPSSPPSDL"
    "pragha"
    "presentations18"
    "presentations18free"
    "prismlauncher"
    "profanity"
    "psi"
    "psi-plus"
    "pybitmessage"
    "pycharm-community"
    "pycharm-professional"
    "pyradio"
    "pzstd"
    "qbittorrent"
    "qcomicbook"
    "qemu-common"
    "qemu-launcher"
    "qemu-system-x86_64"
    "qgis"
    "qlipper"
    "QMediathekView"
    "qmmp"
    "qnapi"
    "QOwnNotes"
    "qpdf"
    "qpdfview"
    "qq"
    "qrencode"
    "qt5ct"
    "qt6ct"
    "qt-faststart"
    "qtox"
    "quadrapassel"
    "quassel"
    "quaternion"
    "quiterss"
    "quodlibet"
    "qupzilla"
    "qutebrowser"
    "raincat"
    "rambox"
    "ranger"
    "rawtherapee"
    "reader"
    "redeclipse"
    "rednotebook"
    "redshift"
    "regextester"
    "remmina"
    "remmina-file-wrapper"
    "retroarch"
    "rhythmbox"
    "rhythmbox-client"
    "ricochet"
    "riot-desktop"
    "riot-web"
    "ripperx"
    "ristretto"
    "rnano"
    "rocketchat"
    "rpcs3"
    "rssguard"
    "rsync-download_only"
    "rtin"
    "rtorrent"
    "rtv"
    "rtv-addons"
    "runenpass.sh"
    "rview"
    "rvim"
    "rymdport"
    "sayonara"
    "scallion"
    "scorched3d"
    "scorched3d-wrapper"
    "scorchwentbonkers"
    "scp"
    "Screenshot"
    "scribus"
    "sdat2img"
    "seafile-applet"
    "seahorse"
    "seahorse-adventures"
    "seahorse-daemon"
    "seahorse-tool"
    "seamonkey"
    "seamonkey-bin"
    "secret-tool"
    "semver"
    "server"
    "servo"
    "session-desktop"
    "session-messenger"
    "session-messenger-desktop"
    "sftp"
    "sha1sum"
    "sha224sum"
    "sha256sum"
    "sha384sum"
    "sha512sum"
    "shellcheck"
    "shortwave"
    "shotcut"
    "shotwell"
    "signal-cli"
    "signal-desktop"
    "silentarmy"
    "simple-scan"
    "simplescreenrecorder"
    "simutrans"
    "singularity"
    "skanlite"
    "skypeforlinux"
    "slack"
    "slashem"
    "smplayer"
    "smtube"
    "smuxi-frontend-gnome"
    "sniffnet"
    "snox"
    "soffice"
    "softmaker-common"
    "sol"
    "songrec"
    "soundconverter"
    "sound-juicer"
    "spectacle"
    "spectral"
    "spectre-meltdown-checker"
    "spotify"
    "sqlitebrowser"
    "ssh"
    "ssh-agent"
    "ssmtp"
    "standard-notes"
    "standardnotes-desktop"
    "start-tor-browser"
    "start-tor-browser.desktop"
    "statusof"
    "steam"
    "steam-native"
    "steam-runtime"
    "stellarium"
    "strawberry"
    "straw-viewer"
    "strings"
    "studio.sh"
    "subdownloader"
    "sum"
    "supertux2"
    "supertuxkart"
    "supertuxkart-wrapper"
    "surf"
    "sushi"
    "sway"
    "swell-foop"
    "sylpheed"
    "syncthing"
    "synfigstudio"
    "sysprof"
    "sysprof-cli"
    "system-log-common"
    "tar"
    "tb-starter-wrapper"
    "tcpdump"
    "teams"
    "teams-for-linux"
    "teamspeak3"
    "teeworlds"
    "telegram"
    "Telegram"
    "telegram-desktop"
    "telnet"
    "terasology"
    "termshark"
    "tesseract"
    "tex"
    "textmaker18"
    "textmaker18free"
    "textroom"
    "thunar"
    "Thunar"
    "thunderbird"
    "thunderbird-beta"
    "thunderbird-wayland"
    "tidal-hifi"
    "tilp"
    "tin"
    "tiny-rdm"
    "tmux"
    "tor"
    "tor-browser"
    "torbrowser"
    "tor-browser-ar"
    "tor-browser_ar"
    "tor-browser-ca"
    "tor-browser_ca"
    "tor-browser-cs"
    "tor-browser_cs"
    "tor-browser-da"
    "tor-browser_da"
    "tor-browser-de"
    "tor-browser_de"
    "tor-browser-el"
    "tor-browser_el"
    "tor-browser-en"
    "tor-browser_en"
    "tor-browser-en-us"
    "tor-browser_en-US"
    "tor-browser-es"
    "tor-browser_es"
    "tor-browser-es-es"
    "tor-browser_es-ES"
    "tor-browser-fa"
    "tor-browser_fa"
    "tor-browser-fr"
    "tor-browser_fr"
    "tor-browser-ga-ie"
    "tor-browser_ga-IE"
    "tor-browser-he"
    "tor-browser_he"
    "tor-browser-hu"
    "tor-browser_hu"
    "tor-browser-id"
    "tor-browser_id"
    "tor-browser-is"
    "tor-browser_is"
    "tor-browser-it"
    "tor-browser_it"
    "tor-browser-ja"
    "tor-browser_ja"
    "tor-browser-ka"
    "tor-browser_ka"
    "tor-browser-ko"
    "tor-browser_ko"
    "torbrowser-launcher"
    "tor-browser-nb"
    "tor-browser_nb"
    "tor-browser-nl"
    "tor-browser_nl"
    "tor-browser-pl"
    "tor-browser_pl"
    "tor-browser-pt-br"
    "tor-browser_pt-BR"
    "tor-browser-ru"
    "tor-browser_ru"
    "tor-browser-sv-se"
    "tor-browser_sv-SE"
    "tor-browser-tr"
    "tor-browser_tr"
    "tor-browser-vi"
    "tor-browser_vi"
    "tor-browser-zh-cn"
    "tor-browser_zh-CN"
    "tor-browser-zh-tw"
    "tor-browser_zh-TW"
    "torcs"
    "totem"
    "tqemu"
    "tracker"
    "transgui"
    "transmission-cli"
    "transmission-common"
    "transmission-create"
    "transmission-daemon"
    "transmission-edit"
    "transmission-gtk"
    "transmission-qt"
    "transmission-remote"
    "transmission-remote-cli"
    "transmission-remote-gtk"
    "transmission-show"
    "tremc"
    "tremulous"
    "trojita"
    "truecraft"
    "ts3client_runscript.sh"
    "tshark"
    "tuir"
    "tutanota-desktop"
    "tuxguitar"
    "tuxtype"
    "tvbrowser"
    "tvnamer"
    "twitch"
    "typespeed"
    "udiskie"
    "uefitool"
    "uget-gtk"
    "unar"
    "unbound"
    "uncompress"
    "unf"
    "unknown-horizons"
    "unlz4"
    "unlzma"
    "unrar"
    "unxz"
    "unzip"
    "unzstd"
    "url-eater"
    "utox"
    "uudeview"
    "uzbl-browser"
    "vesktop"
    "Viber"
    "viewnior"
    "viking"
    "vim"
    "vimcat"
    "vimdiff"
    "vimpager"
    "vimtutor"
    "virt-manager"
    "virtualbox"
    "VirtualBox"
    "vivaldi"
    "vivaldi-beta"
    "vivaldi-snapshot"
    "vivaldi-stable"
    "vlc"
    "vmplayer"
    "vmware"
    "vmware-player"
    "vmware-view"
    "vmware-workstation"
    "vscodium"
    "vulturesclaw"
    "vultureseye"
    "vym"
    "w3m"
    "warmux"
    "warsow"
    "warzone2100"
    "waterfox"
    "waterfox-classic"
    "waterfox-current"
    "webstorm"
    "webui-aria2"
    "weechat"
    "weechat-curses"
    "wesnoth"
    "wget"
    "wget2"
    "whalebird"
    "whois"
    "widelands"
    "wine"
    "wire-desktop"
    "wireshark"
    "wireshark-gtk"
    "wireshark-qt"
    "wordwarvi"
    "wpp"
    "wps"
    "wpspdf"
    "x2goclient"
    "xarchiver"
    "xbill"
    "xcalc"
    "xchat"
    "xed"
    "Xephyr"
    "xfburn"
    "xfce4-dict"
    "xfce4-mixer"
    "xfce4-notes"
    "xfce4-screenshooter"
    "xiphos"
    "xlinks"
    "xlinks2"
    "XMind"
    "xmms"
    "xmr-stak"
    "xonotic"
    "xonotic-glx"
    "xonotic-sdl"
    "xonotic-sdl-wrapper"
    "xournal"
    "xournalpp"
    "xpdf"
    "xplayer"
    "xplayer-audio-preview"
    "xplayer-video-thumbnailer"
    "xpra"
    "xreader"
    "xreader-previewer"
    "xreader-thumbnailer"
    "x-terminal-emulator"
    "Xvfb"
    "xviewer"
    "xxd"
    "xz"
    "xzcat"
    "xzcmp"
    "xzdec"
    "xzdiff"
    "xzegrep"
    "xzfgrep"
    "xzgrep"
    "xzless"
    "xzmore"
    "yandex-browser"
    "yarn"
    "yelp"
    "youtube"
    "youtube-dl"
    "youtube-dl-gui"
    "youtube-music-desktop-app"
    "youtubemusic-nativefier"
    "youtube-viewer"
    "youtube-viewer-gtk"
    "youtube-viewers-common"
    "yt-dlp"
    "ytmdesktop"
    "zaproxy"
    "zart"
    "zathura"
    "zcat"
    "zcmp"
    "zdiff"
    "zeal"
    "ZeGrapher"
    "zegrep"
    "zfgrep"
    "zforce"
    "zgrep"
    "zim"
    "zless"
    "zlib-flate"
    "zmore"
    "znew"
    "zoom"
    "zpaq"
    "zstd"
    "zstdcat"
    "zstdgrep"
    "zstdless"
    "zstdmt"
    "zulip"
  ];

  # Generate options for each program dynamically
  programOptions = builtins.listToAttrs (
    map (program: {
      name = program;
      value = {
        enable = mkEnableOption "firejail sandboxing for ${program}";
      };
    })
    allFirejailPrograms
  );

  # Get list of enabled programs
  enabledPrograms = filter (program: cfg.${program}.enable or false) allFirejailPrograms;

  # Helper function to safely get executable path
  getExecutablePath = program: let
    # Try common package names for the program
    possiblePackages = [
      program
      "${program}-bin"
      "${program}-desktop"
      (lib.replaceStrings ["-"] ["_"] program)
    ];

    # Find the first package that exists
    availablePackage = lib.findFirst (pkg: pkgs ? ${pkg}) null possiblePackages;

    # If we found a package, use it; otherwise assume the program is in PATH
    packagePath =
      if availablePackage != null
      then "${lib.getBin pkgs.${availablePackage}}/bin/${program}"
      else "/run/current-system/sw/bin/${program}";
  in
    packagePath;

  # Helper function to get profile path with fallback
  getProfilePath = program: let
    specificProfile = "${pkgs.firejail}/etc/firejail/${program}.profile";
    defaultProfile = "${pkgs.firejail}/etc/firejail/default.profile";
  in
    # Always use the specific profile if it should exist, firejail will handle missing ones gracefully
    specificProfile;
in {
  options.custom.firejail =
    programOptions
    // {
      enable = mkOption {
        type = types.bool;
        default = enabledPrograms != [];
        description = ''
          Enable firejail sandboxing. This option is automatically enabled
          when any individual program sandboxing is enabled.
        '';
      };
    };

  config = mkIf (enabledPrograms != []) {
    programs.firejail = {
      enable = true;
      wrappedBinaries = builtins.listToAttrs (
        map (program: {
          name = program;
          value = {
            executable = getExecutablePath program;
            profile = getProfilePath program;
            desktop = null; # Disable desktop file creation to avoid conflicts
          };
        })
        enabledPrograms
      );
    };

    # Ensure firejail package is available
    environment.systemPackages = [pkgs.firejail];
  };
}
